<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
        <title>Solving the Zebra Puzzle with LINQ and C# 7</title>
        <link media="all" href="/blog/style/pygments-nuvola.css" rel="stylesheet" />
        <link media="all" href="/blog/style/main.css" rel="stylesheet" />
        <link href="/favicon.ico" rel="shortcut icon" />
        <link href="/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Reenie+Beanie&amp;text=WilFqua" />
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Droid+Sans" />
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Inconsolata" />
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css" />
        <link href="/blog/atom/" type="application/atom+xml" rel="alternate" title="Atom Feed" />
        <link href="/blog/rss/" type="application/rss+xml" rel="alternate" title="RSS Feed" />
        <script>
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-38553935-1']);
            _gaq.push(['_trackPageview']);
            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
    <meta name="description" content="I recently ran across `the Zebra Puzzle`_, a logic..." />
    <meta name="keywords" content="csharp" />
    </head>
    <body>
        <header>
            <a href="/blog/" rel="contents home start" class="blogtitle"><span class="first-name">Will</span><span class="last-name">Fuqua</span></a>
        </header>
        
        <nav>
    <ul>
        <li><a class="top" href="#" title="Top of page"><i class="icon-chevron-up"></i></a><span class="label">Top&nbsp;of&nbsp;page</span></li>
        <li><a class="root" href="http://fuqua.io/blog" title="Home"><i class="icon-home"></i></a><span class="label">Home</span></li>
        <li><a class="bottom" href="#comments" title="Comments"><i class="icon-chevron-down"></i></a><span class="label">Comments</span></li>
    </ul>
</nav>
<article>
    <h1>Solving the Zebra Puzzle with LINQ and C# 7</h1>
    <p>I recently ran across <a class="reference external" href="https://en.wikipedia.org/wiki/Zebra_Puzzle">the Zebra Puzzle</a>, a logic puzzle from about 50 years&nbsp;ago:</p>
<blockquote>
<ol class="arabic simple">
<li>There are five&nbsp;houses.</li>
<li>The Englishman lives in the red&nbsp;house.</li>
<li>The Spaniard owns the&nbsp;dog.</li>
<li>Coffee is drunk in the green&nbsp;house.</li>
<li>The Ukrainian drinks&nbsp;tea.</li>
<li>The green house is immediately to the right of the ivory&nbsp;house.</li>
<li>The Old Gold smoker owns&nbsp;snails.</li>
<li>Kools are smoked in the yellow&nbsp;house.</li>
<li>Milk is drunk in the middle&nbsp;house.</li>
<li>The Norwegian lives in the first&nbsp;house.</li>
<li>The man who smokes Chesterfields lives in the house next to the man with the&nbsp;fox.</li>
<li>Kools are smoked in the house next to the house where the horse is&nbsp;kept.</li>
<li>The Lucky Strike smoker drinks orange&nbsp;juice.</li>
<li>The Japanese smokes&nbsp;Parliaments.</li>
<li>The Norwegian lives next to the blue&nbsp;house.</li>
</ol>
<p>Now, who drinks water? Who owns the&nbsp;zebra?</p>
</blockquote>
<p>This problem is a bit of a pain to solve by hand, so it&#8217;s no surprise that there&#8217;s <a class="reference external" href="http://rosettacode.org/wiki/Zebra_puzzle">a long list of programs available to solve it</a>. If you look at the C# solution on that page, you may be dismayed at how long and enterprisey it is. It clocks in at about 450 lines, using the Microsoft Solver Foundation. While it gets points for using a logic engine, the code is pretty&nbsp;unreadable.</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Peter_Norvig">Peter Norvig</a> wrote a solution in Python, which is available in his <a class="reference external" href="https://www.udacity.com/wiki/cs212/unit-2">Udacity <span class="caps">CS212</span></a> course. I&#8217;ve reproduced it here. The numbered comments refer to the corresponding requirement number from the original problem&nbsp;description.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>

<span class="k">def</span> <span class="nf">zebra_puzzle</span><span class="p">():</span>
    <span class="s2">&quot;Return a tuple (<span class="caps">WATER</span>, <span class="caps">ZEBRA</span>) indicating their house numbers.&quot;</span>
    <span class="n">houses</span> <span class="o">=</span> <span class="n">first</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="c1">#1</span>
    <span class="n">orderings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">houses</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">next</span><span class="p">((</span><span class="n"><span class="caps">WATER</span></span><span class="p">,</span> <span class="n"><span class="caps">ZEBRA</span></span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">ivory</span><span class="p">,</span> <span class="n">yellow</span><span class="p">,</span> <span class="n">blue</span><span class="p">)</span> <span class="ow">in</span> <span class="n">orderings</span>
            <span class="k">if</span> <span class="n">imright</span><span class="p">(</span><span class="n">green</span><span class="p">,</span> <span class="n">ivory</span><span class="p">)</span>      <span class="c1">#6</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">Englishman</span><span class="p">,</span> <span class="n">Spaniard</span><span class="p">,</span> <span class="n">Ukranian</span><span class="p">,</span> <span class="n">Japanese</span><span class="p">,</span> <span class="n">Norwegian</span><span class="p">)</span> <span class="ow">in</span> <span class="n">orderings</span>
            <span class="k">if</span> <span class="n">Englishman</span> <span class="ow">is</span> <span class="n">red</span>          <span class="c1">#2</span>
            <span class="k">if</span> <span class="n">Norwegian</span> <span class="ow">is</span> <span class="n">first</span>         <span class="c1">#10</span>
            <span class="k">if</span> <span class="n">nextto</span><span class="p">(</span><span class="n">Norwegian</span><span class="p">,</span> <span class="n">blue</span><span class="p">)</span>    <span class="c1">#15</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">coffee</span><span class="p">,</span> <span class="n">tea</span><span class="p">,</span> <span class="n">milk</span><span class="p">,</span> <span class="n">oj</span><span class="p">,</span> <span class="n"><span class="caps">WATER</span></span><span class="p">)</span> <span class="ow">in</span> <span class="n">orderings</span>
            <span class="k">if</span> <span class="n">coffee</span> <span class="ow">is</span> <span class="n">green</span>            <span class="c1">#4</span>
            <span class="k">if</span> <span class="n">Ukranian</span> <span class="ow">is</span> <span class="n">tea</span>            <span class="c1">#5</span>
            <span class="k">if</span> <span class="n">milk</span> <span class="ow">is</span> <span class="n">middle</span>             <span class="c1">#9</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">OldGold</span><span class="p">,</span> <span class="n">Kools</span><span class="p">,</span> <span class="n">Chesterfields</span><span class="p">,</span> <span class="n">LuckyStrike</span><span class="p">,</span> <span class="n">Parliaments</span><span class="p">)</span> <span class="ow">in</span> <span class="n">orderings</span>
            <span class="k">if</span> <span class="n">Kools</span> <span class="ow">is</span> <span class="n">yellow</span>            <span class="c1">#8</span>
            <span class="k">if</span> <span class="n">LuckyStrike</span> <span class="ow">is</span> <span class="n">oj</span>          <span class="c1">#13</span>
            <span class="k">if</span> <span class="n">Japanese</span> <span class="ow">is</span> <span class="n">Parliaments</span>    <span class="c1">#14</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">dog</span><span class="p">,</span> <span class="n">snails</span><span class="p">,</span> <span class="n">fox</span><span class="p">,</span> <span class="n">horse</span><span class="p">,</span> <span class="n"><span class="caps">ZEBRA</span></span><span class="p">)</span> <span class="ow">in</span> <span class="n">orderings</span>
            <span class="k">if</span> <span class="n">Spaniard</span> <span class="ow">is</span> <span class="n">dog</span>            <span class="c1">#3</span>
            <span class="k">if</span> <span class="n">OldGold</span> <span class="ow">is</span> <span class="n">snails</span>          <span class="c1">#7</span>
            <span class="k">if</span> <span class="n">nextto</span><span class="p">(</span><span class="n">Chesterfields</span><span class="p">,</span> <span class="n">fox</span><span class="p">)</span> <span class="c1">#12</span>
            <span class="k">if</span> <span class="n">nextto</span><span class="p">(</span><span class="n">Kools</span><span class="p">,</span> <span class="n">horse</span><span class="p">)</span>       <span class="c1">#11</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">imright</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">):</span>
    <span class="s2">&quot;House h1 is immediately right of h2 if h1-h2 == 1.&quot;</span>
    <span class="k">return</span> <span class="n">h1</span><span class="o">-</span><span class="n">h2</span> <span class="o">==</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">nextto</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">):</span>
    <span class="s2">&quot;Two houses are next to each other if they differ by 1.&quot;</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">h1</span><span class="o">-</span><span class="n">h2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>

<span class="k">print</span><span class="p">(</span><span class="n">zebra_puzzle</span><span class="p">())</span>
</pre></div>
<p>Let&#8217;s take a moment to understand this code. This solution represents each house as an integer. It generates all permutations of houses, and then self-joins these permutations (called <tt class="docutils literal">orderings</tt>) repeatedly. On each join, it binds each integer to an attribute name, like &#8216;Englishman&#8217;, &#8216;red&#8217;, or &#8216;coffee&#8217;. Each requirement in the above problem description is then a simple integer equality check. It applies each requirements as early as possible to filter out invalid&nbsp;permutations.</p>
<p>In my opinion, this is an incredibly readable and concise solution compared to the existing C# solution, and its fast execution time (a couple of milliseconds) shows that you don&#8217;t always need a high-powered logic engine if you&#8217;re dealing with a relatively small number of possible solutions. I wanted to solve this problem in a similar way, in C#. It ended up being an interesting tour through some new C# 7&nbsp;features.</p>
<div class="section" id="c-implementation">
<h2>C#&nbsp;Implementation</h2>
<p>Since we&#8217;ll be using some new C# 7 features in this post, if you&#8217;re following along at home, you&#8217;ll want to do the&nbsp;following:</p>
<ol class="arabic simple">
<li>Download the most recent Visual Studio 2017 release (currently in <span class="caps">RC</span>). This will also install the latest pre-release version of C#&nbsp;7.</li>
<li>Create a new solution, and install the <tt class="docutils literal">System.ValueTuple</tt> pre-release Nuget package. This will enable some additional C# 7&nbsp;features.</li>
</ol>
<p>First up, let&#8217;s knock out the easy part: writing the helper functions. Nothing too interesting here, it&#8217;s just a straightforward translation of the python helper&nbsp;functions:</p>
<div class="highlight"><pre><span></span><span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// Is house h1 immediately right of h2?</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">ImmediatelyRight</span><span class="p">(</span><span class="kt">int</span> <span class="n">h1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h2</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">h1</span> <span class="p">-</span> <span class="n">h2</span> <span class="p">==</span> <span class="m">1</span><span class="p">;</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// Are house h1 and h2 next to each other?</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">NextTo</span><span class="p">(</span><span class="kt">int</span> <span class="n">h1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">h2</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">Math</span><span class="p">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">h1</span> <span class="p">-</span> <span class="n">h2</span><span class="p">)</span> <span class="p">==</span> <span class="m">1</span><span class="p">;</span>
</pre></div>
</div>
<div class="section" id="new-c-7-feature-deconstruction">
<h2>New C# 7 feature:&nbsp;Deconstruction</h2>
<p>Next, we need to set up the initial house variables. The python version uses destructuring here, so we do the same, using C# 7&#8217;s <a class="reference external" href="https://github.com/dotnet/roslyn/blob/master/docs/features/deconstruction.md">new deconstruction feature</a> on the second&nbsp;line:</p>
<div class="highlight"><pre><span></span><span class="c1">// set up the houses</span>
<span class="kt">int</span><span class="p">[]</span> <span class="n">houses</span> <span class="p">=</span> <span class="p">{</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span> <span class="p">};</span>
<span class="p">(</span><span class="kt">int</span> <span class="n">first</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="kt">int</span> <span class="n">middle</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="p">=</span> <span class="n">houses</span><span class="p">;</span>
</pre></div>
<p>The above deconstruction statement splits the <tt class="docutils literal">houses</tt> array into 5 separate variables. We only care about the first and middle houses, so we discard the other variables by using the underscore discard variable in their&nbsp;places.</p>
<p>However, if we write that exact code, it won&#8217;t compile! C# doesn&#8217;t know how to deconstruct an array. We can teach C# how to do this by writing a <tt class="docutils literal">Deconstruct</tt> extension method for&nbsp;arrays:</p>
<div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="n">Deconstruct</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="k">this</span> <span class="n">T</span><span class="p">[]</span> <span class="n">array</span><span class="p">,</span> <span class="k">out</span> <span class="n">T</span> <span class="n">first</span><span class="p">,</span> <span class="k">out</span> <span class="n">T</span> <span class="n">second</span><span class="p">,</span> <span class="k">out</span> <span class="n">T</span> <span class="n">third</span><span class="p">,</span> <span class="k">out</span> <span class="n">T</span> <span class="n">fourth</span><span class="p">,</span> <span class="k">out</span> <span class="n">T</span><span class="p">[]</span> <span class="n">rest</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">first</span> <span class="p">=</span> <span class="n">array</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
    <span class="n">second</span> <span class="p">=</span> <span class="n">array</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>
    <span class="n">third</span> <span class="p">=</span> <span class="n">array</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>
    <span class="n">fourth</span> <span class="p">=</span> <span class="n">array</span><span class="p">[</span><span class="m">3</span><span class="p">];</span>
    <span class="n">rest</span> <span class="p">=</span> <span class="n">array</span><span class="p">.</span><span class="n">Skip</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="n">ToArray</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
<p>Any type can implement <tt class="docutils literal">Deconstruct</tt> as a method or extension method, and it will then be able to take part in the new C# 7 deconstruction syntax. This method we just wrote only works for deconstructing into 5 variables, but that&#8217;s all we need right now. Additional extension methods for array deconstruction can be found <a class="reference external" href="https://gist.github.com/waf/280152ab42aa92a85b79d6dbc812e68a">in this gist</a>.</p>
</div>
<div class="section" id="new-c-7-feature-tuples">
<h2>New C# 7 feature:&nbsp;Tuples</h2>
<p>Our last step is to translate the Python list comprehension into a C# <span class="caps">LINQ</span> statement. What we&#8217;d like to write is something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="c1">// this code does <span class="caps">NOT</span> work</span>
<span class="kt">var</span> <span class="n">answers</span> <span class="p">=</span>
    <span class="k">from</span> <span class="p">(</span><span class="n">Red</span><span class="p">,</span> <span class="n">Green</span><span class="p">,</span> <span class="n">Ivory</span><span class="p">,</span> <span class="n">Yellow</span><span class="p">,</span> <span class="n">Blue</span><span class="p">)</span> <span class="k">in</span> <span class="n">orderings</span>
    <span class="c1">//... etc.</span>
</pre></div>
<p>It would be nice if C# 7 recognized our <tt class="docutils literal">Deconstruct</tt> method and it all Just Worked. However, C# 7 doesn&#8217;t support deconstruction in <span class="caps">LINQ</span> statements (see the <a class="reference external" href="https://github.com/dotnet/roslyn/issues/13964">issue tracking it</a>), so we can&#8217;t quite do this&nbsp;yet.</p>
<p>There&#8217;s a workaround: rather than deconstructing inside the <span class="caps">LINQ</span> statement, we can represent our permutations as a list of <tt class="docutils literal">System.ValueTuples</tt>.</p>
<p><tt class="docutils literal">System.ValueTuple</tt> isn&#8217;t related to the existing <tt class="docutils literal">System.Tuple</tt> type. A <tt class="docutils literal">System.ValueTuple</tt> is different in that you can optionally name its tuple members (no more Item1, Item2, etc!). It can also be returned from a method and retain those member names, unlike an anonymous&nbsp;type.</p>
<p>In our initial permutation list, we won&#8217;t name the tuple&nbsp;members:</p>
<div class="highlight"><pre><span></span><span class="kt">var</span> <span class="n">orderings</span> <span class="p">=</span>
    <span class="c1">// generates List&lt;List&lt;int&gt;&gt; using the Combinatorics nuget package</span>
    <span class="k">new</span> <span class="n">Permutations</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="n">houses</span><span class="p">)</span>
    <span class="c1">// creates List&lt;System.ValueTuple&lt;int, int, int, int, int&gt;&gt;</span>
    <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="m">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="m">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="m">4</span><span class="p">])).</span><span class="n">ToList</span><span class="p">();</span>
</pre></div>
<p>We can then provide helper functions to translate unnamed tuples into named tuples for each house&nbsp;attribute:</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="kt">int</span> <span class="n">Red</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Green</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Ivory</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Yellow</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Blue</span><span class="p">)</span>
    <span class="n">AsColors</span><span class="p">((</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="n">permutation</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">permutation</span><span class="p">;</span>

<span class="p">(</span><span class="kt">int</span> <span class="n">Englishman</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Spaniard</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Ukranian</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Japanese</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Norwegian</span><span class="p">)</span>
    <span class="n">AsNationalities</span><span class="p">((</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="n">permutation</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">permutation</span><span class="p">;</span>

<span class="p">(</span><span class="kt">int</span> <span class="n">Coffee</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Tea</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Milk</span><span class="p">,</span> <span class="kt">int</span> <span class="n"><span class="caps">OJ</span></span><span class="p">,</span> <span class="kt">int</span> <span class="n">Water</span><span class="p">)</span>
    <span class="n">AsDrinks</span><span class="p">((</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="n">permutation</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">permutation</span><span class="p">;</span>

<span class="p">(</span><span class="kt">int</span> <span class="n">OldGold</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Kools</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Chesterfields</span><span class="p">,</span> <span class="kt">int</span> <span class="n">LuckyStrike</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Parliaments</span><span class="p">)</span>
    <span class="n">AsCigarettes</span><span class="p">((</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="n">permutation</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">permutation</span><span class="p">;</span>

<span class="p">(</span><span class="kt">int</span> <span class="n">Dog</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Snail</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Fox</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Horse</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Zebra</span><span class="p">)</span>
    <span class="n">AsPets</span><span class="p">((</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="n">permutation</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">permutation</span><span class="p">;</span>
</pre></div>
<p>With the above workaround in place, it&#8217;s now a straightforward translation of the original problem description, complete with static typing&nbsp;goodness:</p>
<div class="highlight"><pre><span></span><span class="c1">// solve the problem</span>
<span class="kt">var</span> <span class="n">answers</span> <span class="p">=</span>
    <span class="k">from</span> <span class="n">color</span> <span class="k">in</span> <span class="n">orderings</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">AsColors</span><span class="p">)</span>
    <span class="k">where</span> <span class="nf">ImmediatelyRight</span><span class="p">(</span><span class="n">color</span><span class="p">.</span><span class="n">Green</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">Ivory</span><span class="p">)</span> <span class="c1">//6</span>
    <span class="k">from</span> <span class="n">nationality</span> <span class="k">in</span> <span class="n">orderings</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">AsNationalities</span><span class="p">)</span>
    <span class="k">where</span> <span class="n">nationality</span><span class="p">.</span><span class="n">Englishman</span> <span class="p">==</span> <span class="n">color</span><span class="p">.</span><span class="n">Red</span> <span class="p">&amp;&amp;</span>     <span class="c1">//2</span>
          <span class="n">nationality</span><span class="p">.</span><span class="n">Norwegian</span> <span class="p">==</span> <span class="n">first</span> <span class="p">&amp;&amp;</span>          <span class="c1">//10</span>
          <span class="n">NextTo</span><span class="p">(</span><span class="n">nationality</span><span class="p">.</span><span class="n">Norwegian</span><span class="p">,</span> <span class="n">color</span><span class="p">.</span><span class="n">Blue</span><span class="p">)</span>  <span class="c1">//15</span>
    <span class="k">from</span> <span class="n">drink</span> <span class="k">in</span> <span class="n">orderings</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">AsDrinks</span><span class="p">)</span>
    <span class="k">where</span> <span class="n">drink</span><span class="p">.</span><span class="n">Coffee</span> <span class="p">==</span> <span class="n">color</span><span class="p">.</span><span class="n">Green</span> <span class="p">&amp;&amp;</span>             <span class="c1">//4</span>
          <span class="n">drink</span><span class="p">.</span><span class="n">Tea</span> <span class="p">==</span> <span class="n">nationality</span><span class="p">.</span><span class="n">Ukranian</span> <span class="p">&amp;&amp;</span>       <span class="c1">//5</span>
          <span class="n">drink</span><span class="p">.</span><span class="n">Milk</span> <span class="p">==</span> <span class="n">middle</span>                       <span class="c1">//9</span>
    <span class="k">from</span> <span class="n">smoke</span> <span class="k">in</span> <span class="n">orderings</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">AsCigarettes</span><span class="p">)</span>
    <span class="k">where</span> <span class="n">smoke</span><span class="p">.</span><span class="n">Kools</span> <span class="p">==</span> <span class="n">color</span><span class="p">.</span><span class="n">Yellow</span> <span class="p">&amp;&amp;</span>             <span class="c1">//8</span>
          <span class="n">smoke</span><span class="p">.</span><span class="n">LuckyStrike</span> <span class="p">==</span> <span class="n">drink</span><span class="p">.</span><span class="n"><span class="caps">OJ</span></span> <span class="p">&amp;&amp;</span>           <span class="c1">//13</span>
          <span class="n">nationality</span><span class="p">.</span><span class="n">Japanese</span> <span class="p">==</span> <span class="n">smoke</span><span class="p">.</span><span class="n">Parliaments</span>  <span class="c1">//14</span>
    <span class="k">from</span> <span class="n">pet</span> <span class="k">in</span> <span class="n">orderings</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">AsPets</span><span class="p">)</span>
    <span class="k">where</span> <span class="n">nationality</span><span class="p">.</span><span class="n">Spaniard</span> <span class="p">==</span> <span class="n">pet</span><span class="p">.</span><span class="n">Dog</span> <span class="p">&amp;&amp;</span>         <span class="c1">//3</span>
          <span class="n">smoke</span><span class="p">.</span><span class="n">OldGold</span> <span class="p">==</span> <span class="n">pet</span><span class="p">.</span><span class="n">Snail</span> <span class="p">&amp;&amp;</span>              <span class="c1">//7</span>
          <span class="n">NextTo</span><span class="p">(</span><span class="n">smoke</span><span class="p">.</span><span class="n">Chesterfields</span><span class="p">,</span> <span class="n">pet</span><span class="p">.</span><span class="n">Fox</span><span class="p">)</span> <span class="p">&amp;&amp;</span>    <span class="c1">//12</span>
          <span class="n">NextTo</span><span class="p">(</span><span class="n">smoke</span><span class="p">.</span><span class="n">Kools</span><span class="p">,</span> <span class="n">pet</span><span class="p">.</span><span class="n">Horse</span><span class="p">)</span>             <span class="c1">//11</span>
    <span class="k">select</span> <span class="k">new</span> <span class="p">{</span> <span class="n">drink</span><span class="p">.</span><span class="n">Water</span><span class="p">,</span> <span class="n">pet</span><span class="p">.</span><span class="n">Zebra</span> <span class="p">};</span>

<span class="kt">var</span> <span class="n">answer</span> <span class="p">=</span> <span class="n">answers</span><span class="p">.</span><span class="n">Single</span><span class="p">();</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="s">&quot;Water drinker lives in {answer.Water} and zebra owner lives in {answer.Zebra}&quot;</span><span class="p">);</span>
</pre></div>
<p>Running this, we get the&nbsp;output:</p>
<blockquote>
Water drinker lives in 1 and zebra owner lives in 5</blockquote>
<p>And we&#8217;re done! We found that sneaky zebra&nbsp;owner.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>Overall, I feel like this <span class="caps">LINQ</span> implementation is fairly faithful to the original Python implementation, and in about 70 lines of code. If <span class="caps">LINQ</span> supported deconstruction, I would be 100% happy with it. However, due to the lack of <span class="caps">LINQ</span> support, we needed a couple of helper functions, and that definitely spoiled the fun a&nbsp;bit.</p>
<p><tt class="docutils literal">System.ValueTuple</tt> looks like a very useful feature &#8211; but I&#8217;ll need to be careful to balance this with code readability concerns. Sometimes it might be better to break a <tt class="docutils literal">System.ValueTuple</tt> into a named class with documentation. For cases like this blog post though, where the types are only ever used inside a single method or class, I think it&#8217;s a valuable&nbsp;feature.</p>
</div>

    <div class="tags">
        
            tagged as
                <a href="/blog/tag/csharp/" rel="tag">csharp</a>
                
        
    </div>
    <script src="https://apis.google.com/js/plusone.js">
    </script>
    <div id="comments">
        <div class="g-comments"
            data-href="http://fuqua.io/blog/2017/01/solving-the-zebra-puzzle-with-linq-and-c-7/"
            data-width="642"
            data-first_party_property="BLOGGER"
            data-view_type="FILTERED_POSTMOD">
        </div>
    </div>
</article>
<script src="/blog/script/list.min.js"></script>
    </body>
</html>